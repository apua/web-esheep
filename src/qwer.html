<!--
  TODO:

  - learn how it detect edge
  - setup a page to check each animation defined in XML
-->

<!DOCTYPE html>
<meta charset="utf-8">
<link rel="icon" href="#">

<style>
  html {
    color-scheme: dark;
    font-family: system-ui;
  }
</style>

<script type="module">
  import { fromUri, listPetSources } from "./esheep5.1.js";

  pets.addEventListener('input', async event => {
    const dict = await fromUri(event.target.value);

    const arrAnimations = [...dict.get('animations')];
    petAnimations.replaceChildren(...arrAnimations.map(ani => {
      const opt = document.createElement('option');
      opt.label = `${ani.get('id')} ${ani.get('name')}`;
      opt.value = ani.get('id');
      return opt;
    }));

    const spriteData = dict.get('image').get('png');
    petSprite.src = `data:image/png;base64,${spriteData}`;
  });

  listPetSources().then(petsMap => {
    pets.append(...[...petsMap.entries()].map(
      ([k, v]) => {
        const opt = document.createElement('option');
        opt.label = k;
        opt.value = v;
        return opt;
      }
    ));

    // Select esheep64
    [...pets.children].find(elm => elm.label == 'esheep64').selected = true;
    pets.dispatchEvent(new Event('input'));
  });

  //import eSheep from "./esheep.js";
  ////(new eSheep({allowPets: "all"})).Start('https://adrianotiger.github.io/desktopPet/Pets/blue_sheep/animations.xml');

  //import eSheep from "./esheep5.js";
  //(new eSheep()).Start();
  //(new eSheep({allowPets: "all"})).Start('https://adrianotiger.github.io/desktopPet/Pets/yellow_sheep/animations.xml');
</script>

<fieldset><legend>Select a pet</legend>
<select id="pets"></select>
</fieldset>

<fieldset><legend>Select a animation</legend>
<select id="petAnimations"></select>
</fieldset>

<fieldset><legend>Animation</legend>
<img id="animation"></img>
</fieldset>

<fieldset><legend>Sprite</legend>
<img id="petSprite">
</fieldset>
